/*
 * bird configuration for mp-bgp mpls vpn 4+6
 */ 
# log to stdout only
# log "bird.log" all;

debug commands 2;
debug protocols all;

router id 10.0.0.1;
define myas = 65000;

mrtdump protocols all;

ipv4 table master4;
ipv6 table master6;
vpn4 table mastervpn4;
vpn6 table mastervpn6;
ipv4 table mpls4;
ipv6 table mpls6;

### templates
template bgp bgp_peer {
    debug all;
    mrtdump all;
    local as myas;
    ipv4 { import all; export none; extended next hop on; };
    ipv6 { import all; export none; extended next hop on; };
    vpn4 mpls { import all; export none; extended next hop on; table mastervpn4; };
    vpn6 mpls { import all; export none; extended next hop on; table mastervpn6; };
    ipv4 mpls { import all; export none; extended next hop on; table mpls4; };
    ipv6 mpls { import all; export none; extended next hop on; table mpls6; };
    multihop;
    enable as4 on;
    enable extended messages off;
    capabilities on;
    interpret communities off;  
    deterministic med on;
}

protocol bgp gobgp from bgp_peer {
    neighbor 172.18.0.7 port 17000 as 65000;
    local 172.18.0.7 as 65000;

    ipv4 { table master4; };
    ipv6 { table master6; };
    vpn4 mpls { 
        table mastervpn4;
        import filter { accept; };
        export none;
        extended next hop;
    };
    vpn6 mpls { 
        table mastervpn6; 
        import filter { accept; };
        export none;
        extended next hop;
    };
}

protocol mrt {
    table mastervpn4;
    filename "test.data.long-community.vpn4.mrt";
    period 60;
}

protocol mrt {
    table mastervpn6;
    filename "test.data.long-community.vpn6.mrt";
    period 60;
}

protocol mrt {
    table master4;
    filename "test.data.long-community.ipv4.mrt";
    period 60;
}

protocol mrt {
    table master6;
    filename "test.data.long-community.ipv6.mrt";
    period 60;
}

protocol mrt {
    table mpls4;
    filename "test.data.long-community.ipv4-mpls.mrt";
    period 60;
}

protocol mrt {
    table mpls6;
    filename "test.data.long-community.ipv6-mpls.mrt";
    period 60;
}

